<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your TorPay Credentials</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Onest:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/torpay-merchant.css') }}">
</head>
<body class="torpay-merchant">
  <div class="torpay-auth-container" style="max-width: 720px;">
    <div class="torpay-auth-card torpay-animate" style="padding: 2rem; border: 1px solid var(--torpay-gray-200);">
      <div class="torpay-auth-logo">
        <div class="torpay-auth-logo-icon"></div>
        <h1 class="torpay-auth-title" style="margin-bottom: 0.25rem;">Save your credentials</h1>
        <p class="torpay-auth-subtitle">Shown once. Store them offline before continuing.</p>
      </div>

      {% if credentials.message %}
      <div class="torpay-alert torpay-alert-info" style="margin-bottom: 1rem;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="16" x2="12" y2="12"/>
          <line x1="12" y1="8" x2="12.01" y2="8"/>
        </svg>
        <span>{{ credentials.message }}</span>
      </div>
      {% endif %}

      <div class="torpay-card" style="border: 1px solid var(--torpay-gray-100); box-shadow: none; margin-bottom: 1.25rem;">
        <div class="torpay-card-body">
          <div class="torpay-form-group">
            <label class="torpay-form-label">Login ID</label>
            <div class="torpay-code" style="font-size: 1rem; word-break: break-all;">{{ credentials.login_id }}</div>
            <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" class="torpay-btn torpay-btn-secondary torpay-btn-sm" onclick="copySecretValue('{{ credentials.login_id }}', this)">Copy ID</button>
            </div>
          </div>
          <div class="torpay-form-group" style="margin-top: 1rem;">
            <label class="torpay-form-label">Login Secret</label>
            <div style="display: flex; gap: 0.5rem; align-items: center;">
              <input
                type="password"
                id="login-secret"
                class="torpay-form-input"
                value="{{ credentials.login_secret }}"
                readonly
                style="font-family: monospace; flex: 1;"
              >
              <button type="button" class="torpay-btn torpay-btn-secondary torpay-btn-sm" onclick="toggleSecret('login-secret', this)">Show</button>
              <button type="button" class="torpay-btn torpay-btn-secondary torpay-btn-sm" onclick="copySecret('login-secret', this)">Copy</button>
            </div>
          </div>
          <div style="margin-top: 1rem;">
            <button type="button" class="torpay-btn torpay-btn-secondary torpay-btn-sm" onclick="copyAll(this)">Copy ID + Secret</button>
          </div>
        </div>
      </div>

      <div class="torpay-alert torpay-alert-warning" style="margin: 1.25rem 0;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 9v4"/>
          <path d="M12 17h.01"/>
          <path d="M3 21h18L12 2z"/>
        </svg>
        <span>
          Keep your security phrase safe. It's required to rotate your login secret and request payouts, and it is never displayed here.
        </span>
      </div>

      <div style="display: flex; gap: 0.75rem; flex-direction: column;">
        <button type="button" class="torpay-btn torpay-btn-secondary torpay-btn-lg" onclick="downloadCreds()">
          Download credentials (.txt)
        </button>
        <a class="torpay-btn torpay-btn-primary torpay-btn-lg" style="width: 100%; text-align: center;" href="{{ url_for('merchant_auth.dashboard') }}">
          Go to dashboard
        </a>
      </div>
    </div>
  </div>
  <script>
    function toggleSecret(id, btn) {
      const el = document.getElementById(id);
      if (!el) return;
      el.type = el.type === 'password' ? 'text' : 'password';
      btn.textContent = el.type === 'password' ? 'Show' : 'Hide';
    }
    function copySecret(id, btn) {
      const el = document.getElementById(id);
      if (!el) return;
      el.select();
      el.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(el.value);
      btn.textContent = 'Copied';
      setTimeout(() => btn.textContent = 'Copy', 1500);
    }
    function downloadCreds() {
      const loginId = "{{ credentials.login_id }}";
      const loginSecret = "{{ credentials.login_secret }}";
      const content = [
        "TorPay Merchant Credentials",
        "---------------------------",
        "Login ID: " + loginId,
        "Login Secret: " + loginSecret,
        "",
        "Security phrase: (not stored; you set this during registration)",
        "",
        "Store offline. These credentials are not shown again."
      ].join("\\n");
      const blob = new Blob([content], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "torpay-credentials.txt";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }
    function copySecretValue(val, btn) {
      navigator.clipboard.writeText(val);
      btn.textContent = 'Copied';
      setTimeout(() => btn.textContent = 'Copy ID', 1500);
    }
    function copyAll(btn) {
      const loginId = "{{ credentials.login_id }}";
      const loginSecret = "{{ credentials.login_secret }}";
      const bundle = "Login ID: " + loginId + "\\nLogin Secret: " + loginSecret;
      navigator.clipboard.writeText(bundle);
      btn.textContent = 'Copied';
      setTimeout(() => btn.textContent = 'Copy ID + Secret', 1500);
    }
  </script>
</body>
</html>
