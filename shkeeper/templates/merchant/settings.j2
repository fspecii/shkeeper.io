{% extends 'merchant/base.j2' %}

{% block title %}Settings{% endblock %}

{% block content %}
<form method="post">
  <!-- Callback Settings -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">Callback Settings</h5>
    </div>
    <div class="card-body">
      <div class="mb-3">
        <label class="form-label">Default Callback URL</label>
        <input type="url" name="callback_url_base" class="form-control"
               value="{{ merchant.callback_url_base or '' }}"
               placeholder="https://your-site.com/webhook">
        <small class="text-muted">Optional: Default callback URL for payment notifications. Can be overridden per invoice.</small>
      </div>
    </div>
  </div>

  <!-- Payout Addresses -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">Payout Addresses</h5>
    </div>
    <div class="card-body">
      <p class="text-muted">Configure your wallet addresses for each cryptocurrency to receive payouts.</p>

      {# Payout addresses are parsed server-side via merchant.get_payout_address() #}

      <div class="mb-3">
        <label class="form-label">Bitcoin (BTC)</label>
        <input type="text" name="payout_address_BTC" class="form-control font-monospace"
               value="{{ merchant.get_payout_address('BTC') or '' }}"
               placeholder="bc1q...">
      </div>

      <div class="mb-3">
        <label class="form-label">Ethereum (ETH)</label>
        <input type="text" name="payout_address_ETH" class="form-control font-monospace"
               value="{{ merchant.get_payout_address('ETH') or '' }}"
               placeholder="0x...">
      </div>

      <div class="mb-3">
        <label class="form-label">Tether (USDT-TRC20)</label>
        <input type="text" name="payout_address_USDT-TRC20" class="form-control font-monospace"
               value="{{ merchant.get_payout_address('USDT-TRC20') or '' }}"
               placeholder="T...">
      </div>

      <div class="mb-3">
        <label class="form-label">Monero (XMR)</label>
        <input type="text" name="payout_address_XMR" class="form-control font-monospace"
               value="{{ merchant.get_payout_address('XMR') or '' }}"
               placeholder="4...">
      </div>

      <div class="mb-3">
        <label class="form-label">Litecoin (LTC)</label>
        <input type="text" name="payout_address_LTC" class="form-control font-monospace"
               value="{{ merchant.get_payout_address('LTC') or '' }}"
               placeholder="ltc1q...">
      </div>
    </div>
  </div>

  <!-- Payout Preferences -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">Payout Preferences</h5>
    </div>
    <div class="card-body">
      <div class="mb-3">
        <div class="form-check">
          <input type="checkbox" name="auto_payout" class="form-check-input" id="auto_payout"
                 {% if merchant.auto_payout %}checked{% endif %}>
          <label class="form-check-label" for="auto_payout">Enable automatic payouts</label>
        </div>
        <small class="text-muted">Automatically process payouts when balance exceeds threshold.</small>
      </div>

      <div class="mb-3">
        <label class="form-label">Minimum Payout Amount (USD)</label>
        <input type="number" name="min_payout_amount" class="form-control"
               value="{{ merchant.min_payout_amount|default(100, true) }}"
               min="1" step="1">
        <small class="text-muted">Minimum balance required before you can request a payout.</small>
      </div>
    </div>
  </div>

  <div class="d-grid">
    <button type="submit" class="btn btn-primary btn-lg">Save Settings</button>
  </div>
</form>
{% endblock %}
